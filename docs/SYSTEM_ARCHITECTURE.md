# System Architecture & Data Flow

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     INSURANCE REQUIREMENTS & COI APPROVAL SYSTEM                 â”‚
â”‚                      Version 1.0                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CORE ENGINE LAYER                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚   Requirements       â”‚  â”‚   Notification      â”‚                  â”‚
â”‚  â”‚   Engine             â”‚  â”‚   System            â”‚                  â”‚
â”‚  â”‚                      â”‚  â”‚                     â”‚                  â”‚
â”‚  â”‚ â€¢ Universal Base     â”‚  â”‚ â€¢ Admin Upload      â”‚                  â”‚
â”‚  â”‚ â€¢ Tier 1, 2, 3      â”‚  â”‚ â€¢ COI Approved      â”‚                  â”‚
â”‚  â”‚ â€¢ Project Mods      â”‚  â”‚ â€¢ Deficiencies      â”‚                  â”‚
â”‚  â”‚ â€¢ Validation        â”‚  â”‚ â€¢ All Stakeholders  â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚           â”‚                         â”‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚     Portal Link Builder                    â”‚                    â”‚
â”‚  â”‚  (Every notification includes links)       â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   USER INTERFACE LAYER                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Admin Dashboard         â”‚  â”‚ Project Requirements     â”‚            â”‚
â”‚  â”‚ â€¢ Pending Reviews       â”‚  â”‚ â€¢ Upload by Tier         â”‚            â”‚
â”‚  â”‚ â€¢ COI Compliance Check  â”‚  â”‚ â€¢ Organize by Trade      â”‚            â”‚
â”‚  â”‚ â€¢ One-Click Approve     â”‚  â”‚ â€¢ Download/Preview       â”‚            â”‚
â”‚  â”‚ â€¢ Deficiency Mgmt       â”‚  â”‚                          â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ Trade Selection      â”‚  â”‚ Sub Requirements Viewer â”‚                â”‚
â”‚  â”‚ â€¢ Tier 1, 2, 3       â”‚  â”‚ â€¢ Filter by Trade       â”‚                â”‚
â”‚  â”‚ â€¢ Multi-trade        â”‚  â”‚ â€¢ Download Docs         â”‚                â”‚
â”‚  â”‚ â€¢ Inline Limits      â”‚  â”‚ â€¢ Share with Broker     â”‚                â”‚
â”‚  â”‚ â€¢ Visual Tiers       â”‚  â”‚ â€¢ View by Project       â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DATA STORAGE LAYER                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  ProjectInsuranceRequirement                GeneratedCOI (Enhanced)   â”‚
â”‚  â€¢ project_id                              â€¢ id                      â”‚
â”‚  â€¢ requirement_tier (1,2,3)               â€¢ compliance_status       â”‚
â”‚  â€¢ applicable_trades[]                    â€¢ compliance_issues[]     â”‚
â”‚  â€¢ document_url                           â€¢ approved_by             â”‚
â”‚  â€¢ is_active                              â€¢ approved_at             â”‚
â”‚                                           â€¢ deficiencies[]          â”‚
â”‚                                           â€¢ requirement_tier        â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow: COI Approval Process

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SUBCONTRACTOR UPLOADS INSURANCE DOCUMENTS                 â”‚
â”‚  (Via BrokerUpload portal)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SYSTEM GENERATES COI FROM DOCUMENTS                        â”‚
â”‚  â€¢ Extracts limits from policies                            â”‚
â”‚  â€¢ Creates GeneratedCOI record                              â”‚
â”‚  â€¢ Marks status: pending_broker                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NOTIFY ADMIN: "COI UPLOADED"                              â”‚
â”‚  â€¢ Email to: admin@insuretrack.com                         â”‚
â”‚  â€¢ Portal Link: /COIReview?id=[coiId]                      â”‚
â”‚  â€¢ Creates: Message record for tracking                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ADMIN OPENS DASHBOARD                                      â”‚
â”‚  â€¢ Sees pending COI in AdminCOIApprovalDashboard            â”‚
â”‚  â€¢ Clicks to view details                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SYSTEM VALIDATES COMPLIANCE                                â”‚
â”‚  validateCOICompliance(coi, project, trades)              â”‚
â”‚                                                             â”‚
â”‚  Checks:                                                   â”‚
â”‚  â€¢ GL: $1M/$2M min + CG2010 + CG2037                      â”‚
â”‚  â€¢ WC: Waiver Sub + Waiver Excess                         â”‚
â”‚  â€¢ Auto: Hired/Non-Owned included                         â”‚
â”‚  â€¢ Umbrella: Follow form (if Tier 2/3)                   â”‚
â”‚  â€¢ Additional Insureds: All named                         â”‚
â”‚  â€¢ Exclusions: No project area, no condo                  â”‚
â”‚                                                             â”‚
â”‚  Returns: {compliant, issues, warnings}                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
        â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
        â–¼         â–¼
    COMPLIANT  ISSUES
        â”‚         â”‚
        â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                          â”‚
        â–¼                          â–¼
   APPROVE                    REQUEST CORRECTIONS
        â”‚                          â”‚
        â”‚                          â”œâ”€ notifyCOIDeficiencies()
        â”‚                          â”‚
        â”‚                          â”œâ”€ Email Broker: 
        â”‚                          â”‚  "Corrections Needed"
        â”‚                          â”‚  Portal: /BrokerUpload
        â”‚                          â”‚
        â”‚                          â”œâ”€ Email Sub:
        â”‚                          â”‚  "Certificate Update Needed"
        â”‚                          â”‚  Portal: /sub-dashboard
        â”‚                          â”‚
        â”‚                          â””â”€ Cycle back to UPLOAD
        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  UPDATE GeneratedCOI STATUS:         â”‚
        â”‚  â€¢ status: 'active'                  â”‚
        â”‚  â€¢ approved_by: 'admin'             â”‚
        â”‚  â€¢ approved_at: timestamp            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ NOTIFY ALL STAKEHOLDERS:             â”‚
        â”‚                                      â”‚
        â”‚ 1. Sub: "Certificate Approved"      â”‚
        â”‚    Portal: /sub-dashboard            â”‚
        â”‚                                      â”‚
        â”‚ 2. Broker: "Approval Complete"      â”‚
        â”‚    Portal: /broker-dashboard         â”‚
        â”‚                                      â”‚
        â”‚ 3. GC: "Insurance Approved - Ready" â”‚
        â”‚    Portal: /ProjectDetails           â”‚
        â”‚                                      â”‚
        â”‚ 4. Admin: Logs approval              â”‚
        â”‚    Message record created            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ SUBCONTRACTOR CLEARED   â”‚
        â”‚ CAN WORK ON PROJECT     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Requirements Escalation by Trade

```
TIER 1                      TIER 2                      TIER 3
General Construction        Specialty Trades            High-Risk Trades

Carpentry                   Roofing                     Crane Operator
Electrical                  Excavation                  Scaffold
Plumbing
HVAC

GL: $1M/$2M                 GL: $2M/$5M                 GL: $3M/$6M
â”œâ”€ 2x tier 1                â”œâ”€ 2x tier 1                â”œâ”€ 3x tier 1
â”‚                           â”‚                           â”‚
WC: $1M                     WC: $1M                     WC: $1M
â”œâ”€ Same                     â”œâ”€ Same                     â”œâ”€ Same
â”‚                           â”‚                           â”‚
Auto: $1M                   Auto: $1M                   Auto: $1M
â”œâ”€ Hired/Non-Owned         â”œâ”€ Hired/Non-Owned         â”œâ”€ Hired/Non-Owned
â”‚                           â”‚                           â”‚
Umbrella: NOT REQ'D        Umbrella: $2M REQ'D        Umbrella: $3M REQ'D
â”‚                          â”œâ”€ NEW for tier 2          â”œâ”€ NEW for tier 3
â”‚                          â”‚                          â”‚
CG2010 + CG2037            CG2010 + CG2037            CG2010 + CG2037
Waiver Subrogation         Waiver Subrogation         Waiver Subrogation
All Insureds Named         All Insureds Named         All Insureds Named
```

---

## Component Interaction Map

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           STAKEHOLDER INTERACTION DIAGRAM                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                         ADMIN
                           â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚              â”‚              â”‚
            â–¼              â–¼              â–¼
    ProjectReqs      AdminDashboard   AdminCOI
    Manager          (View Stats)      Review
    (Upload)         (Approve/Reject)  (Details)
            â”‚              â”‚              â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                â”‚                â”‚
        â–¼                â–¼                â–¼
   SUBCONTRACTOR    BROKER          GENERAL CONTRACTOR
        â”‚              â”‚                 â”‚
        â”œâ”€ Sees â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€ Reviews â”€â”€â”€â”€â”€â”€â”¤â”€ Monitors
        â”‚   project     â”‚   COI          â”‚   status
        â”‚   requirementsâ”‚   compliance   â”‚
        â”‚   from Admin  â”‚                â”‚
        â”‚              â”‚                â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
        â”‚  â”‚ SubReqViewer        â”‚      â”‚
        â”‚  â”‚ (Download Docs)     â”‚      â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
        â”‚              â”‚                â”‚
        â”œâ”€ Shares doc  â”‚                â”‚
        â”‚ with Broker  â”‚                â”‚
        â”‚              â”‚                â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚ TradeSelection (adds     â”‚ â”‚
        â”‚  â”‚ to ProjectDetails)       â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚              â”‚                â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚ BrokerUpload             â”‚ â”‚
        â”‚  â”‚ (Upload docs/COI)        â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚              â”‚                â”‚
        â”‚              â”œâ”€ Notification: â”‚
        â”‚              â”‚  Upload        â”‚
        â”‚              â”‚                â”‚
        â”‚              â””â”€ Goes to Admin â”‚
        â”‚                               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Database Relationships

```
Project
â”œâ”€ Many ProjectInsuranceRequirement
â”‚  â”œâ”€ requirement_tier (1, 2, 3)
â”‚  â”œâ”€ applicable_trades []
â”‚  â””â”€ document_url
â”‚
â””â”€ Many ProjectSubcontractor
   â”œâ”€ subcontractor_id
   â”œâ”€ trade_types []              â—„â”€â”€â”€ Determines tier
   â”‚
   â””â”€ Many GeneratedCOI
      â”œâ”€ compliance_status        â—„â”€â”€â”€ Based on trade tier
      â”œâ”€ compliance_issues []
      â”œâ”€ approved_by
      â””â”€ requirement_tier         â—„â”€â”€â”€ Calculated from trades

Contractor (Broker)
â””â”€ Many Contractor (Subcontractor)
   â”œâ”€ trade_types []              â—„â”€â”€â”€ Selectable per sub
   â”‚
   â””â”€ Many Assigned Projects
      â””â”€ COI for each project + trade combo
```

---

## Information Flow: Email Notifications

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      NOTIFICATION GENERATION            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  Trigger Event                         â”‚
â”‚  â”œâ”€ COI uploaded                       â”‚
â”‚  â”œâ”€ Admin approves COI                 â”‚
â”‚  â”œâ”€ Admin rejects COI                  â”‚
â”‚  â”œâ”€ Sub added to project               â”‚
â”‚  â””â”€ Policy renewal detected            â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    notificationLinks (Link Builder)    â”‚
â”‚                                         â”‚
â”‚  For each recipient:                   â”‚
â”‚  â€¢ Get portal section link              â”‚
â”‚  â€¢ Add parameters (IDs, emails)        â”‚
â”‚  â€¢ Create clickable URLs               â”‚
â”‚                                         â”‚
â”‚  Examples:                              â”‚
â”‚  /subcontractor-dashboard?id=X         â”‚
â”‚  /broker-dashboard?email=Y             â”‚
â”‚  /COIReview?id=Z                       â”‚
â”‚  /ProjectDetails?id=W                  â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Email Body Construction               â”‚
â”‚                                         â”‚
â”‚  1. Greeting                            â”‚
â”‚  2. Issue context                       â”‚
â”‚  3. Action required                     â”‚
â”‚  4. [Portal link]                       â”‚
â”‚  5. Fallback instructions              â”‚
â”‚                                         â”‚
â”‚  Example:                               â”‚
â”‚  "Your certificate was approved."       â”‚
â”‚  "View dashboard: [LINK]"              â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   compliant.integrations.Core.SendEmail   â”‚
â”‚                                         â”‚
â”‚  âœ‰ï¸  To: recipient@email.com            â”‚
â”‚  ğŸ“‹ Subject: [Action Required]         â”‚
â”‚  ğŸ“ Body: [With portal link]           â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Recipient Receives Email             â”‚
â”‚                                         â”‚
â”‚  âœ… Clicks portal link                  â”‚
â”‚  âœ… Lands on specific page              â”‚
â”‚  âœ… Can take action immediately        â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Compliance Validation Flow

```
COI Submitted
â”‚
â”œâ”€ Extract Data
â”‚  â”œâ”€ GL limits
â”‚  â”œâ”€ WC limits
â”‚  â”œâ”€ Auto limits
â”‚  â”œâ”€ Umbrella limits
â”‚  â”œâ”€ Endorsements
â”‚  â”œâ”€ Waivers
â”‚  â””â”€ Exclusions
â”‚
â”œâ”€ Get Subcontractor Trades
â”‚  â””â”€ ['carpentry', 'electrical']
â”‚
â”œâ”€ Determine Requirement Tier
â”‚  â””â”€ Highest tier = Tier 1 (both)
â”‚     All get Tier 1 requirements
â”‚
â”œâ”€ Get Project Modifiers
â”‚  â”œâ”€ Is it condo? â†’ Add condo rules
â”‚  â””â”€ Is it high-rise? â†’ Multiply limits 1.5x
â”‚
â”œâ”€ Build Full Requirements
â”‚  â”œâ”€ Universal base
â”‚  â”œâ”€ Tier-specific
â”‚  â”œâ”€ Project modifiers
â”‚  â””â”€ Trade escalation
â”‚
â”œâ”€ VALIDATE
â”‚  â”‚
â”‚  â”œâ”€ Check GL Limits
â”‚  â”‚  â”œâ”€ Each: required â‰¤ provided?
â”‚  â”‚  â”œâ”€ Aggregate: required â‰¤ provided?
â”‚  â”‚  â””â”€ Products: required â‰¤ provided?
â”‚  â”‚
â”‚  â”œâ”€ Check Endorsements
â”‚  â”‚  â”œâ”€ CG2010 present?
â”‚  â”‚  â”œâ”€ CG2037 present?
â”‚  â”‚  â””â”€ Blanket basis?
â”‚  â”‚
â”‚  â”œâ”€ Check Waivers
â”‚  â”‚  â”œâ”€ Subrogation on GL?
â”‚  â”‚  â”œâ”€ Subrogation on Umbrella?
â”‚  â”‚  â”œâ”€ Subrogation on WC?
â”‚  â”‚  â””â”€ Excess on WC?
â”‚  â”‚
â”‚  â”œâ”€ Check Insureds
â”‚  â”‚  â”œâ”€ All named from project?
â”‚  â”‚  â””â”€ On GL and Umbrella?
â”‚  â”‚
â”‚  â”œâ”€ Check Exclusions
â”‚  â”‚  â”œâ”€ No project area?
â”‚  â”‚  â””â”€ No condo (if condo)?
â”‚  â”‚
â”‚  â””â”€ Check Follow Form
â”‚     â””â”€ Umbrella follow form?
â”‚
â””â”€ RETURN RESULT
   â”œâ”€ Compliant: true/false
   â”œâ”€ Issues: []
   â”œâ”€ Warnings: []
   â””â”€ requirements_applied: {}
```

---

## System Readiness Checklist

```
IMPLEMENTATION PHASE
â”œâ”€ âœ… Core Files Created (7)
â”‚  â”œâ”€ insuranceRequirements.js
â”‚  â”œâ”€ coiNotifications.js
â”‚  â”œâ”€ notificationLinkBuilder.js
â”‚  â”œâ”€ ProjectRequirementsManager.jsx
â”‚  â”œâ”€ ProjectRequirementsViewer.jsx
â”‚  â”œâ”€ AdminCOIApprovalDashboard.jsx
â”‚  â””â”€ TradeSelectionComponent.jsx
â”‚
â”œâ”€ âœ… Documentation Created (4)
â”‚  â”œâ”€ INSURANCE_REQUIREMENTS_SYSTEM.md
â”‚  â”œâ”€ IMPLEMENTATION_SUMMARY.md
â”‚  â”œâ”€ QUICK_REFERENCE.md
â”‚  â””â”€ This architecture guide
â”‚
â”œâ”€ â³ Integration Required
â”‚  â”œâ”€ SubcontractorsManagement.jsx
â”‚  â”œâ”€ ProjectDetails.jsx
â”‚  â”œâ”€ COIReview.jsx
â”‚  â”œâ”€ AdminDashboard.jsx
â”‚  â”œâ”€ SubcontractorDashboard.jsx
â”‚  â””â”€ BrokerDashboard.jsx
â”‚
â”œâ”€ â³ Database Updates
â”‚  â”œâ”€ Create ProjectInsuranceRequirement entity
â”‚  â””â”€ Add fields to GeneratedCOI
â”‚
â””â”€ â³ Testing & Deployment
   â”œâ”€ Unit tests for validation
   â”œâ”€ Integration testing
   â”œâ”€ UAT with all roles
   â”œâ”€ Staging deployment
   â””â”€ Production rollout
```

---

**Ready for full integration and deployment!**
